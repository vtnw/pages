<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="viewport" content="width =device-width, initial-scale=1.0">
    <title>Home</title>    
</head>
<body>    
    <div id="dvLinks"></div>
    <input type="text" id="tbLink" placeholder="add" style="border:none;outline:none;width:90%" />
    <script>
      var key = decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURIComponent("u").replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));
      var cacheName = "home" + key;
      document.getElementById("tbLink").addEventListener("keyup", function (event) {
          event.preventDefault();
          var value = document.getElementById("tbLink").value.trim();
          if (event.keyCode == 13 && value != "") {
              if(value == "export"){
                  buildLinks(value);
              } else {
                  var links = getCache();
                  var linkData = value.split("|");
                  links.push({"title": linkData[0], "url": linkData[1]});
                  links.sort(function (a, b) { return a.title > b.title });
                  setCache(links);
                  buildLinks();
              }
              document.getElementById("tbLink").value = "";
              document.getElementById("tbLink").blur();
          }
      });
      function buildLinks(mode) {
          var links = getCache();
          var dvLinks = document.getElementById("dvLinks");
          dvLinks.innerHTML = "";
          for (var i = 0; i < links.length; i++) {
              if(mode == "export"){
                  var span1 = document.createElement('span');
                  span1.innerHTML = links[i].title;
                  var span2 = document.createElement('span');
                  span2.innerHTML = links[i].url;
                  dvLinks.appendChild(span1);
                  dvLinks.appendChild(document.createElement('br'));
                  dvLinks.appendChild(span2);
              } else {
                  var a = document.createElement('a');                
                  a.setAttribute("href", links[i].url);
                  a.innerHTML = links[i].title;
                  dvLinks.appendChild(a);
              }
              dvLinks.appendChild(document.createElement('br'));
              dvLinks.appendChild(document.createElement('br'));              
          }
      }        
      function getCache() {
          var items = JSON.parse(localStorage.getItem(cacheName));
          if (items == null) {
              items = [];
          }          
          return items;
      }
      function setCache(items) {
          localStorage.setItem(cacheName, JSON.stringify(items));
      }
      buildLinks();
    </script>
</body>
</html>
