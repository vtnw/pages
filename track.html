<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="viewport" content="width =device-width, initial-scale=1.0">
    <title>Track</title>    
</head>
<body>
    <input type="text" id="tbItem" readonly style="border:1px solid #cccccc;border-radius:25px; width:94%;
            padding: 5px 10px 5px 10px;outline: none;font-size: 16px;" />
    <br /><br />
    <div id="dvTypes">
        <a href='javascript:setType("notes","view","latest");'>notes</a><br/><br/>
        <a href='javascript:setType("internet","edit","latest");'>internet</a><br/><br/>
        <a href='javascript:setType("tasks","edit","athruz");'>tasks</a><br/><br/>
        <a href='javascript:setType("links","link","athruz");'>links</a>
    </div>
    <div id="dvItems"></div>
    <script>
        var cacheName,itemType,itemMode,itemSort;
        var cachePrefix = "item";
        document.getElementById("tbItem").addEventListener("keyup", function (event) {
            event.preventDefault();
            if (event.keyCode == 13 && document.getElementById("tbItem").value.trim() != "") {
                var items = getCache();
                items.push(document.getElementById("tbItem").value);
                document.getElementById("tbItem").value = "";
                document.getElementById("tbItem").blur();
                setCache(items);
                buildItems();
            }
        });
        function setType(type,mode,sort) {
            itemType = type;
            itemMode = mode;
            itemSort = sort;
            document.getElementById("dvTypes").style.display = "none";
            document.getElementById("tbItem").placeholder = type;
            document.getElementById("tbItem").readOnly = false;
            buildItems();
        }
        function buildItems() {
            var items = getCache();
            var dvItems = document.getElementById("dvItems");
            dvItems.innerHTML = "";
            for (var i = 0; i < items.length; i++) {
                var dvItem = document.createElement('div');
                dvItem.innerHTML = items[i];
                dvItem.setAttribute("index", i);
                dvItem.appendChild(document.createElement('br'));
                dvItem.appendChild(document.createElement('br'));
                if(itemMode == "link") {
                    dvItem.setAttribute("style", "cursor:pointer;text-decoration:underline");
                    dvItem.addEventListener("click", function () {
                        window.open(this.innerText);
                    });
                }
                else if(itemMode == "edit") {
                    dvItem.addEventListener("click", function () {
                        var index = parseInt(this.getAttribute("index"));
                        var items = getCache();
                        items.splice(index, 1);
                        setCache(items);
                        buildItems();
                        document.getElementById("tbItem").value = this.innerText;
                    });
                }
                else if(itemMode == "view") {
                    
                }
                dvItems.insertBefore(dvItem, dvItems.firstChild);
            }
        }
        function getCacheName(){
            return cachePrefix + itemType;
        }
        function getCache() {
            var items = JSON.parse(localStorage.getItem(getCacheName()));
            if (items == null) {
                items = [];
            }
            switch(itemSort) {
                case "athruz": {
                    items.sort(function(a,b){return b.localeCompare(a)});break;
                }
                case "zthrua": {
                    items.sort(function(a,b){return a.localeCompare(b)});break;
                }
                case "latest": {
                    break;
                }
            }
            return items;
        }
        function setCache(items) {
            localStorage.setItem(getCacheName(), JSON.stringify(items));
        }
        buildItems();
    </script>
</body>
</html>
