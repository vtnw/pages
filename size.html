<!DOCTYPE html>
<html manifest="nocache.appcache">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE =edge">
    <meta name="viewport" content="width =device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="images/icon.png" />
    <link rel="manifest" href="manifest.json">
    <style>
        .spnKey{
            width:70px;
            border:1px solid #cccccc;
            margin: 5px 5px 5px 5px;
            padding: 5px 5px 5px 5px;
        }
        .spnSize{
            width:70px;
            border:1px solid #cccccc;
            margin: 5px 5px 5px 5px;
            padding: 5px 5px 5px 5px;
        }
    </style>
</head>
<body>
    <div id="dvItems" class="dvItems">
    </div>
  <script lang="javascript">    
    function calcSize(){
        var items = [];
        var total = 0;
        var item;
        
        for(var key in localStorage){
            if(localStorage.hasOwnProperty(key)){
                item = {
                    "Key" : key,
                    "Data" : localStorage.getItem(key),
                    "Size" : ((key.length + localStorage.getItem(key).length)*16)/(8*1024)
                    };
                items.push(item);
                total += item.Size;
            }
        }
        items.push({
            "Key" : "[Default]",
            "Data" : null,
            "Size" : 3
            });
        total += 3;
        items.push({
            "Key" : "[Total]",
            "Data" : null,
            "Size" : total
            });
        return items;
    }
    function showSize(items){
        for(var i = 0; i < items.length; i++){
            var dvItem = document.createElement("div");
            dvItem.className = "dvItem";
            
            var spnKey = document.createElement("span");
            spnKey.className = "spnKey";
            spnKey.innerHTML = items[i].Key;
            dvItem.appendChild(spnKey);
            
            var spnSize = document.createElement("span");
            spnSize.className = "spnSize";
            spnSize.innerHTML = items[i].Size.toFixed(2) + " kb";
            dvItem.appendChild(spnSize);
            
            if(items[i].Key != "[Default]"){
                var btnClear = document.createElement("input");
                btnClear.setAttribute("type", "button");
                btnClear.className = "btnClear";
                btnClear.value = "Clear";
                btnClear.key = items[i].Key;
                btnClear.addEventListener("click", function(){
                    if(this.key == "[Total]"){
                        localStorage.clear();
                    } else {
                        localStorage.removeItem(this.key);
                    }
                });
                dvItem.appendChild(btnClear);

                var btnExport = document.createElement("input");
                btnExport.setAttribute("type", "button");
                btnExport.className = "btnExport";
                btnExport.value = "Export";
                btnExport.key = items[i].Key;
                btnExport.addEventListener("click", function(){
                    if(this.key == "[Total]"){
                        alert(JSON.stringify(localStorage));
                    } else {
                        alert(JSON.stringify(localStorage.getItem(this.key)));
                    }
                });
                dvItem.appendChild(btnClear);
            }
            
            document.getElementById("dvItems").appendChild(dvItem);
        }
    }
    showSize(calcSize());
  </script>
</body>
</html>
